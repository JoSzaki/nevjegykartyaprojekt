<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>N√©vjegyk√°rtya Szerkeszt≈ë</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@400;500;700&family=Montserrat:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #22263a;
      --border: rgba(255,255,255,0.08);
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --text: #e2e8f0;
      --text-muted: #7c859e;
      --radius: 10px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* TOPBAR */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.9rem 2rem;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    .logo { font-size: 1.1rem; font-weight: 700; color: var(--accent); letter-spacing: 1px; }
    .header-actions { display: flex; gap: 0.75rem; }
    .btn {
      padding: 0.55rem 1.2rem;
      border-radius: 6px;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.18s;
      font-family: inherit;
    }
    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
    }
    .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }
    .btn-accent { background: var(--accent); color: #fff; }
    .btn-accent:hover { background: var(--accent-hover); transform: translateY(-1px); }

    /* LAYOUT */
    main {
      display: flex;
      flex: 1;
      overflow: hidden;
      height: calc(100vh - 57px);
    }

    /* SIDEBAR */
    .sidebar {
      width: 340px;
      min-width: 300px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* TABS */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    .tab {
      flex: 1;
      padding: 0.85rem 0.5rem;
      text-align: center;
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.18s;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .tab:hover { color: var(--text); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

    /* TAB PANELS */
    .tab-panels { flex: 1; overflow-y: auto; }
    .tab-panel { display: none; padding: 1.5rem; }
    .tab-panel.active { display: block; }

    /* FORM */
    .field { margin-bottom: 1.1rem; }
    label {
      display: block;
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="url"],
    select,
    textarea {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      padding: 0.65rem 0.85rem;
      font-size: 0.92rem;
      font-family: inherit;
      transition: border-color 0.18s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
    }
    input::placeholder { color: var(--text-muted); }
    select option { background: #1a1d27; }

    /* COLOR ROW */
    .color-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.1rem;
    }
    .color-row label { margin: 0; flex: 1; }
    .color-swatch {
      width: 38px;
      height: 38px;
      border-radius: 6px;
      border: 2px solid var(--border);
      cursor: pointer;
      flex-shrink: 0;
      overflow: hidden;
      padding: 0;
    }
    input[type="color"] {
      width: 38px;
      height: 38px;
      border-radius: 6px;
      border: 2px solid var(--border);
      cursor: pointer;
      padding: 2px;
      background: var(--surface2);
    }
    input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; border-radius: 4px; }
    input[type="color"]::-webkit-color-swatch { border: none; border-radius: 4px; }

    /* PRESET COLORS */
    .preset-label {
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.6rem;
    }
    .presets {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6rem;
      margin-bottom: 1.5rem;
    }
    .preset {
      border-radius: 8px;
      padding: 0.55rem 0.5rem;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.18s, transform 0.15s;
      text-align: center;
      font-size: 0.72rem;
      font-weight: 600;
    }
    .preset:hover { transform: translateY(-2px); }
    .preset.selected { border-color: var(--accent); }

    /* LOGO UPLOAD */
    .upload-zone {
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      padding: 2rem 1rem;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      margin-bottom: 1rem;
    }
    .upload-zone:hover, .upload-zone.drag-over {
      border-color: var(--accent);
      background: rgba(99,102,241,0.05);
    }
    .upload-icon { font-size: 2rem; margin-bottom: 0.5rem; }
    .upload-zone p { font-size: 0.85rem; color: var(--text-muted); }
    .upload-zone strong { color: var(--accent); }
    #logo-input { display: none; }

    .logo-preview-wrap {
      display: none;
      background: var(--surface2);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    .logo-preview-wrap img {
      max-height: 80px;
      max-width: 100%;
      border-radius: 4px;
    }
    .logo-controls { margin-top: 0.75rem; display: flex; justify-content: center; gap: 0.5rem; }

    /* RANGE */
    .range-row { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
    .range-row label { margin: 0; flex-shrink: 0; width: 100px; }
    input[type="range"] {
      flex: 1;
      accent-color: var(--accent);
      background: transparent;
      border: none;
      padding: 0;
    }
    .range-val { font-size: 0.82rem; color: var(--text-muted); width: 30px; text-align: right; }

    /* LAYOUT TEMPLATES */
    .templates {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }
    .template-card {
      border-radius: 8px;
      border: 2px solid var(--border);
      padding: 0.75rem;
      cursor: pointer;
      transition: border-color 0.18s;
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .template-card:hover { border-color: var(--text-muted); }
    .template-card.selected { border-color: var(--accent); color: var(--accent); }
    .template-thumb {
      width: 100%;
      aspect-ratio: 1.75;
      border-radius: 4px;
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--surface2);
      font-size: 1.5rem;
    }

    /* PREVIEW AREA */
    .preview-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 2rem;
      gap: 2rem;
      background: var(--bg);
      overflow-y: auto;
    }

    .preview-label {
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: center;
    }

    /* CARD */
    .card-wrapper {
      perspective: 1000px;
      width: min(560px, 90vw);
    }

    .card-flip {
      position: relative;
      width: 100%;
      aspect-ratio: 1.74;
      transition: transform 0.65s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }
    .card-flip.flipped { transform: rotateY(180deg); }

    .card-face {
      position: absolute;
      inset: 0;
      border-radius: 16px;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      overflow: hidden;
      box-shadow: 0 25px 60px rgba(0,0,0,0.5);
    }

    .card-back { transform: rotateY(180deg); }

    /* CARD INNER */
    #card-front {
      width: 100%;
      height: 100%;
      display: flex;
      position: relative;
      transition: background 0.3s;
    }

    /* LAYOUT: Classic */
    #card-front.layout-classic { flex-direction: column; justify-content: flex-end; padding: 8%; }
    #card-front.layout-classic .card-logo { position: absolute; top: 8%; right: 8%; }
    #card-front.layout-classic .card-name { font-size: clamp(1rem, 3vw, 1.5rem); font-weight: 700; margin-bottom: 0.15em; }
    #card-front.layout-classic .card-title { font-size: clamp(0.6rem, 1.8vw, 0.85rem); margin-bottom: 1em; opacity: 0.75; }
    #card-front.layout-classic .card-contacts { display: flex; flex-direction: column; gap: 0.2em; }
    #card-front.layout-classic .card-contact-item { font-size: clamp(0.55rem, 1.5vw, 0.75rem); opacity: 0.8; display: flex; align-items: center; gap: 0.4em; }

    /* LAYOUT: Centered */
    #card-front.layout-centered { flex-direction: column; justify-content: center; align-items: center; padding: 8%; text-align: center; }
    #card-front.layout-centered .card-logo { margin-bottom: 0.6em; }
    #card-front.layout-centered .card-name { font-size: clamp(1rem, 3vw, 1.5rem); font-weight: 700; margin-bottom: 0.15em; }
    #card-front.layout-centered .card-title { font-size: clamp(0.6rem, 1.8vw, 0.85rem); margin-bottom: 1em; opacity: 0.75; }
    #card-front.layout-centered .card-contacts { display: flex; flex-direction: column; align-items: center; gap: 0.2em; }
    #card-front.layout-centered .card-contact-item { font-size: clamp(0.55rem, 1.5vw, 0.75rem); opacity: 0.8; }

    /* LAYOUT: Split */
    #card-front.layout-split { flex-direction: row; }
    #card-front.layout-split .card-left {
      width: 40%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8%;
      background: rgba(0,0,0,0.2);
    }
    #card-front.layout-split .card-right {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 8%;
    }
    #card-front.layout-split .card-logo { margin-bottom: 0.5em; }
    #card-front.layout-split .card-company { font-size: clamp(0.7rem, 2vw, 1rem); font-weight: 700; text-align: center; }
    #card-front.layout-split .card-name { font-size: clamp(0.9rem, 2.5vw, 1.3rem); font-weight: 700; margin-bottom: 0.15em; }
    #card-front.layout-split .card-title { font-size: clamp(0.55rem, 1.6vw, 0.8rem); margin-bottom: 0.8em; opacity: 0.75; }
    #card-front.layout-split .card-contacts { display: flex; flex-direction: column; gap: 0.2em; }
    #card-front.layout-split .card-contact-item { font-size: clamp(0.5rem, 1.4vw, 0.72rem); opacity: 0.8; display: flex; align-items: center; gap: 0.4em; }

    /* LAYOUT: Minimal */
    #card-front.layout-minimal { flex-direction: column; justify-content: center; padding: 10%; }
    #card-front.layout-minimal .card-logo { margin-bottom: 1em; }
    #card-front.layout-minimal .card-name { font-size: clamp(1.1rem, 3.2vw, 1.7rem); font-weight: 700; margin-bottom: 0.1em; }
    #card-front.layout-minimal .card-title { font-size: clamp(0.6rem, 1.8vw, 0.85rem); margin-bottom: 1.2em; opacity: 0.6; letter-spacing: 2px; text-transform: uppercase; }
    #card-front.layout-minimal .card-contacts { display: flex; flex-direction: column; gap: 0.2em; }
    #card-front.layout-minimal .card-contact-item { font-size: clamp(0.55rem, 1.5vw, 0.75rem); opacity: 0.75; display: flex; align-items: center; gap: 0.4em; }

    /* Card back */
    #card-back {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-back-logo { max-width: 50%; max-height: 50%; object-fit: contain; opacity: 0.85; }
    .card-back-text { font-size: clamp(1rem, 3vw, 1.5rem); font-weight: 700; opacity: 0.3; }

    .card-logo img { max-height: clamp(28px, 5vw, 45px); max-width: clamp(60px, 12vw, 100px); object-fit: contain; }

    /* FLIP BTN */
    .flip-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 0.55rem 1.4rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.82rem;
      font-family: inherit;
      font-weight: 600;
      transition: all 0.18s;
    }
    .flip-btn:hover { border-color: var(--accent); color: var(--accent); }

    /* SCROLLBAR */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    .section-sep {
      border: none;
      border-top: 1px solid var(--border);
      margin: 1.2rem 0;
    }

    .small-btn {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 0.35rem 0.8rem;
      border-radius: 5px;
      font-size: 0.78rem;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
    }
    .small-btn:hover { border-color: var(--accent); color: var(--accent); }
    .small-btn.danger:hover { border-color: #ef4444; color: #ef4444; }

    @media (max-width: 768px) {
      main { flex-direction: column; height: auto; }
      .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--border); }
      .preview-area { padding: 2rem 1rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">CardEditor</div>
  <div class="header-actions">
    <button class="btn btn-ghost" onclick="flipCard()">‚Ü∫ H√°tlap</button>
    <button class="btn btn-accent" onclick="downloadCard()">‚¨á Let√∂lt√©s PNG</button>
  </div>
</header>

<main>
  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="tabs">
      <div class="tab active" onclick="switchTab('tartalom')">Tartalom</div>
      <div class="tab" onclick="switchTab('szinek')">Sz√≠nek</div>
      <div class="tab" onclick="switchTab('logo')">Log√≥</div>
      <div class="tab" onclick="switchTab('elrendez')">Elrendez√©s</div>
    </div>
    <div class="tab-panels">

      <!-- TARTALOM -->
      <div class="tab-panel active" id="panel-tartalom">
        <div class="field">
          <label>Teljes n√©v</label>
          <input type="text" id="f-name" placeholder="pl. Kov√°cs P√©ter" oninput="update()" />
        </div>
        <div class="field">
          <label>Beoszt√°s / C√≠m</label>
          <input type="text" id="f-title" placeholder="pl. √úgyvezet≈ë igazgat√≥" oninput="update()" />
        </div>
        <div class="field">
          <label>C√©g neve</label>
          <input type="text" id="f-company" placeholder="pl. Kov√°cs Kft." oninput="update()" />
        </div>
        <hr class="section-sep">
        <div class="field">
          <label>Telefonsz√°m</label>
          <input type="tel" id="f-phone" placeholder="+36 30 000 0000" oninput="update()" />
        </div>
        <div class="field">
          <label>E-mail c√≠m</label>
          <input type="email" id="f-email" placeholder="pelda@email.hu" oninput="update()" />
        </div>
        <div class="field">
          <label>Weboldal</label>
          <input type="url" id="f-web" placeholder="www.pelda.hu" oninput="update()" />
        </div>
        <div class="field">
          <label>C√≠m</label>
          <input type="text" id="f-address" placeholder="1234 Budapest, P√©lda u. 1." oninput="update()" />
        </div>
        <hr class="section-sep">
        <div class="field">
          <label>Bet≈±t√≠pus</label>
          <select id="f-font" onchange="update()">
            <option value="Inter">Inter (Modern)</option>
            <option value="Playfair Display">Playfair Display (Eleg√°ns)</option>
            <option value="Montserrat">Montserrat (Er≈ëteljes)</option>
            <option value="Roboto">Roboto (Tiszta)</option>
            <option value="Lato">Lato (Bar√°ts√°gos)</option>
          </select>
        </div>
      </div>

      <!-- SZ√çNEK -->
      <div class="tab-panel" id="panel-szinek">
        <div class="preset-label">El≈ëre be√°ll√≠tott st√≠lusok</div>
        <div class="presets">
          <div class="preset selected" style="background:#1a1a2e;color:#e0e0ff;" onclick="applyPreset('#1a1a2e','#e0e0ff','#7c73e6')" data-id="0">√âjk√©k</div>
          <div class="preset" style="background:#1a1a1a;color:#c9a84c;" onclick="applyPreset('#1a1a1a','#c9a84c','#c9a84c')" data-id="1">Fekete-Arany</div>
          <div class="preset" style="background:#f8f8f8;color:#1a1a1a;" onclick="applyPreset('#f8f8f8','#1a1a1a','#3b82f6')" data-id="2">Feh√©r</div>
          <div class="preset" style="background:#0f4c75;color:#ffffff;" onclick="applyPreset('#0f4c75','#ffffff','#1b98e0')" data-id="3">√ìce√°n</div>
          <div class="preset" style="background:#2d4a22;color:#d4e8c0;" onclick="applyPreset('#2d4a22','#d4e8c0','#7bb661')" data-id="4">Erd≈ë</div>
          <div class="preset" style="background:#3d0000;color:#ffd6d6;" onclick="applyPreset('#3d0000','#ffd6d6','#e05c5c')" data-id="5">B√≠bor</div>
        </div>
        <hr class="section-sep">
        <div class="preset-label">Egy√©ni sz√≠nek</div>
        <div class="color-row">
          <label>H√°tt√©rsz√≠n</label>
          <input type="color" id="c-bg" value="#1a1a2e" oninput="updateColors()" />
        </div>
        <div class="color-row">
          <label>Sz√∂veg sz√≠ne</label>
          <input type="color" id="c-text" value="#e0e0ff" oninput="updateColors()" />
        </div>
        <div class="color-row">
          <label>Kiemel≈ë sz√≠n</label>
          <input type="color" id="c-accent" value="#7c73e6" oninput="updateColors()" />
        </div>
        <hr class="section-sep">
        <div class="preset-label">K√°rtya h√°tt√©r</div>
        <div class="field">
          <select id="bg-style" onchange="updateColors()">
            <option value="solid">Egysz√≠n≈±</option>
            <option value="gradient">√Åtmenet (alulr√≥l)</option>
            <option value="gradient-diag">√Åtmenet (√°tl√≥s)</option>
            <option value="gradient-radial">Sug√°rz√≥</option>
          </select>
        </div>
        <div class="color-row">
          <label>√Åtmenet v√©ge</label>
          <input type="color" id="c-bg2" value="#2a2a4e" oninput="updateColors()" />
        </div>
      </div>

      <!-- LOG√ì -->
      <div class="tab-panel" id="panel-logo">
        <div class="upload-zone" id="upload-zone" onclick="document.getElementById('logo-input').click()"
             ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="dropFile(event)">
          <div class="upload-icon">üñºÔ∏è</div>
          <p><strong>Kattintson</strong> vagy h√∫zza ide a log√≥t</p>
          <p style="margin-top:0.3rem; font-size:0.78rem;">PNG, JPG, SVG ‚Äì max. 5 MB</p>
        </div>
        <input type="file" id="logo-input" accept="image/*" onchange="loadLogo(event)" />

        <div class="logo-preview-wrap" id="logo-preview-wrap">
          <img id="logo-preview-img" src="" alt="Log√≥ el≈ën√©zet" />
          <div class="logo-controls">
            <button class="small-btn" onclick="document.getElementById('logo-input').click()">Csere</button>
            <button class="small-btn danger" onclick="removeLogo()">T√∂rl√©s</button>
          </div>
        </div>

        <hr class="section-sep">
        <div class="field">
          <label>Log√≥ poz√≠ci√≥ja</label>
          <select id="logo-pos" onchange="update()">
            <option value="top-left">Bal fels≈ë</option>
            <option value="top-center">Fels≈ë k√∂z√©p</option>
            <option value="top-right" selected>Jobb fels≈ë</option>
            <option value="center">K√∂z√©pen</option>
          </select>
        </div>
        <div class="range-row">
          <label>M√©ret</label>
          <input type="range" id="logo-size" min="20" max="120" value="50" oninput="update(); document.getElementById('logo-size-val').textContent=this.value+'px'" />
          <span class="range-val" id="logo-size-val">50px</span>
        </div>
        <hr class="section-sep">
        <p style="font-size:0.82rem; color:var(--text-muted);">A log√≥ a h√°tlapon is megjelenik.</p>
      </div>

      <!-- ELRENDEZ√âS -->
      <div class="tab-panel" id="panel-elrendez">
        <div class="preset-label" style="margin-bottom:0.8rem;">K√°rtya elrendez√©se</div>
        <div class="templates">
          <div class="template-card selected" data-layout="classic" onclick="setLayout('classic', this)">
            <div class="template-thumb">‚¨Ö ‚Üô</div>
            Klasszikus
          </div>
          <div class="template-card" data-layout="centered" onclick="setLayout('centered', this)">
            <div class="template-thumb">‚äô</div>
            K√∂z√©pre z√°rt
          </div>
          <div class="template-card" data-layout="split" onclick="setLayout('split', this)">
            <div class="template-thumb">‚ñå‚ñê</div>
            Osztott
          </div>
          <div class="template-card" data-layout="minimal" onclick="setLayout('minimal', this)">
            <div class="template-thumb">‚Äî ‚Äî</div>
            Minim√°l
          </div>
        </div>
        <hr class="section-sep">
        <div class="range-row">
          <label>Lekerek√≠t√©s</label>
          <input type="range" id="card-radius" min="0" max="32" value="16"
            oninput="document.querySelectorAll('.card-face').forEach(f=>f.style.borderRadius=this.value+'px'); document.getElementById('r-val').textContent=this.value+'px'" />
          <span class="range-val" id="r-val">16px</span>
        </div>
        <div class="range-row">
          <label>√Årny√©k</label>
          <input type="range" id="card-shadow" min="0" max="80" value="40"
            oninput="setShadow(this.value); document.getElementById('s-val').textContent=this.value" />
          <span class="range-val" id="s-val">40</span>
        </div>
      </div>

    </div>
  </div>

  <!-- PREVIEW -->
  <div class="preview-area">
    <div class="preview-label">El≈ën√©zet ‚Äì El√ºls≈ë oldal</div>

    <div class="card-wrapper">
      <div class="card-flip" id="card-flip">

        <!-- FRONT -->
        <div class="card-face" id="card-face-front">
          <div id="card-front" class="layout-classic">
            <!-- rendered by JS -->
          </div>
        </div>

        <!-- BACK -->
        <div class="card-face card-back" id="card-face-back">
          <div id="card-back">
            <span class="card-back-text" id="back-company-text">C√©g neve</span>
          </div>
        </div>

      </div>
    </div>

    <button class="flip-btn" onclick="flipCard()">‚Ü∫ K√°rtya megford√≠t√°sa</button>
  </div>
</main>

<script>
  // STATE
  let state = {
    name: '', title: '', company: '', phone: '', email: '', web: '', address: '',
    font: 'Inter',
    bgColor: '#1a1a2e', textColor: '#e0e0ff', accentColor: '#7c73e6',
    bgColor2: '#2a2a4e', bgStyle: 'solid',
    logoSrc: null, logoPos: 'top-right', logoSize: 50,
    layout: 'classic',
    flipped: false
  };

  // INIT
  document.getElementById('c-bg').value = state.bgColor;
  document.getElementById('c-text').value = state.textColor;
  document.getElementById('c-accent').value = state.accentColor;
  document.getElementById('c-bg2').value = state.bgColor2;
  renderCard();

  // TABS
  function switchTab(id) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    event.currentTarget.classList.add('active');
    document.getElementById('panel-' + id).classList.add('active');
  }

  // UPDATE from inputs
  function update() {
    state.name = document.getElementById('f-name').value;
    state.title = document.getElementById('f-title').value;
    state.company = document.getElementById('f-company').value;
    state.phone = document.getElementById('f-phone').value;
    state.email = document.getElementById('f-email').value;
    state.web = document.getElementById('f-web').value;
    state.address = document.getElementById('f-address').value;
    state.font = document.getElementById('f-font').value;
    state.logoPos = document.getElementById('logo-pos').value;
    state.logoSize = parseInt(document.getElementById('logo-size').value);
    renderCard();
  }

  function updateColors() {
    state.bgColor = document.getElementById('c-bg').value;
    state.textColor = document.getElementById('c-text').value;
    state.accentColor = document.getElementById('c-accent').value;
    state.bgColor2 = document.getElementById('c-bg2').value;
    state.bgStyle = document.getElementById('bg-style').value;
    renderCard();
  }

  function applyPreset(bg, text, accent) {
    state.bgColor = bg;
    state.textColor = text;
    state.accentColor = accent;
    state.bgColor2 = shiftColor(bg, 20);
    state.bgStyle = 'gradient';
    document.getElementById('c-bg').value = bg;
    document.getElementById('c-text').value = text;
    document.getElementById('c-accent').value = accent;
    document.getElementById('c-bg2').value = state.bgColor2;
    document.getElementById('bg-style').value = 'gradient';
    document.querySelectorAll('.preset').forEach(p => p.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    renderCard();
  }

  function shiftColor(hex, amount) {
    const r = Math.min(255, parseInt(hex.slice(1,3),16) + amount);
    const g = Math.min(255, parseInt(hex.slice(3,5),16) + amount);
    const b = Math.min(255, parseInt(hex.slice(5,7),16) + amount);
    return '#' + [r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
  }

  function setLayout(layout, el) {
    state.layout = layout;
    document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    renderCard();
  }

  function setShadow(v) {
    document.querySelectorAll('.card-face').forEach(f => {
      f.style.boxShadow = `0 ${v*0.6}px ${v*1.5}px rgba(0,0,0,${v/100})`;
    });
  }

  // LOGO
  function loadLogo(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      state.logoSrc = ev.target.result;
      showLogoPreview(ev.target.result);
      renderCard();
    };
    reader.readAsDataURL(file);
  }

  function showLogoPreview(src) {
    document.getElementById('logo-preview-img').src = src;
    document.getElementById('logo-preview-wrap').style.display = 'block';
    document.getElementById('upload-zone').style.display = 'none';
  }

  function removeLogo() {
    state.logoSrc = null;
    document.getElementById('logo-preview-wrap').style.display = 'none';
    document.getElementById('upload-zone').style.display = 'block';
    document.getElementById('logo-input').value = '';
    renderCard();
  }

  function dragOver(e) { e.preventDefault(); document.getElementById('upload-zone').classList.add('drag-over'); }
  function dragLeave(e) { document.getElementById('upload-zone').classList.remove('drag-over'); }
  function dropFile(e) {
    e.preventDefault();
    dragLeave(e);
    const file = e.dataTransfer.files[0];
    if (!file || !file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = (ev) => { state.logoSrc = ev.target.result; showLogoPreview(ev.target.result); renderCard(); };
    reader.readAsDataURL(file);
  }

  // FLIP
  function flipCard() {
    state.flipped = !state.flipped;
    document.getElementById('card-flip').classList.toggle('flipped', state.flipped);
    document.querySelector('.preview-label').textContent =
      state.flipped ? 'El≈ën√©zet ‚Äì H√°tlap' : 'El≈ën√©zet ‚Äì El√ºls≈ë oldal';
  }

  // RENDER
  function renderCard() {
    const s = state;
    const front = document.getElementById('card-front');
    front.className = 'layout-' + s.layout;
    front.style.fontFamily = `'${s.font}', sans-serif`;
    front.style.color = s.textColor;

    // background
    if (s.bgStyle === 'solid') {
      front.style.background = s.bgColor;
    } else if (s.bgStyle === 'gradient') {
      front.style.background = `linear-gradient(to top, ${s.bgColor2}, ${s.bgColor})`;
    } else if (s.bgStyle === 'gradient-diag') {
      front.style.background = `linear-gradient(135deg, ${s.bgColor}, ${s.bgColor2})`;
    } else if (s.bgStyle === 'gradient-radial') {
      front.style.background = `radial-gradient(ellipse at center, ${s.bgColor2}, ${s.bgColor})`;
    }

    // back
    const back = document.getElementById('card-back');
    back.style.background = front.style.background;
    back.style.fontFamily = front.style.fontFamily;

    const logoImg = s.logoSrc ? `<img src="${s.logoSrc}" style="max-height:${s.logoSize}px;max-width:${s.logoSize*2}px;object-fit:contain;" />` : '';

    const contacts = [];
    if (s.phone)   contacts.push({ icon: 'üìû', val: s.phone });
    if (s.email)   contacts.push({ icon: '‚úâ', val: s.email });
    if (s.web)     contacts.push({ icon: 'üåê', val: s.web });
    if (s.address) contacts.push({ icon: 'üìç', val: s.address });

    const contactsHTML = contacts.map(c =>
      `<span class="card-contact-item"><span>${c.icon}</span><span>${c.val}</span></span>`
    ).join('');

    const accentBar = `<div style="width:3px;height:100%;background:${s.accentColor};position:absolute;left:0;top:0;border-radius:2px 0 0 2px;"></div>`;

    if (s.layout === 'classic') {
      front.innerHTML = `
        ${accentBar}
        <div class="card-logo" style="position:absolute;top:8%;right:8%;">${logoImg}</div>
        <div class="card-name" style="color:${s.textColor};">${s.name || 'Teljes N√©v'}</div>
        <div class="card-title" style="color:${s.accentColor};">${s.title || 'Beoszt√°s'}</div>
        <div class="card-contacts">${contactsHTML}</div>
      `;
    } else if (s.layout === 'centered') {
      front.innerHTML = `
        <div class="card-logo">${logoImg}</div>
        <div class="card-name">${s.name || 'Teljes N√©v'}</div>
        <div class="card-title" style="color:${s.accentColor};">${s.title || 'Beoszt√°s'}</div>
        <div class="card-contacts">${contactsHTML}</div>
      `;
    } else if (s.layout === 'split') {
      front.innerHTML = `
        <div class="card-left" style="background:${s.accentColor}22;">
          <div class="card-logo">${logoImg}</div>
          <div class="card-company" style="color:${s.accentColor};">${s.company || 'C√©g'}</div>
        </div>
        <div class="card-right">
          <div class="card-name">${s.name || 'Teljes N√©v'}</div>
          <div class="card-title" style="color:${s.accentColor};">${s.title || 'Beoszt√°s'}</div>
          <div class="card-contacts">${contactsHTML}</div>
        </div>
      `;
    } else if (s.layout === 'minimal') {
      front.innerHTML = `
        <div class="card-logo">${logoImg}</div>
        <div class="card-name">${s.name || 'Teljes N√©v'}</div>
        <div class="card-title" style="color:${s.accentColor};">${s.title || 'Beoszt√°s'}</div>
        <div style="width:40px;height:2px;background:${s.accentColor};margin:0.5em 0 0.8em;"></div>
        <div class="card-contacts">${contactsHTML}</div>
      `;
    }

    // BACK content
    const backContent = document.getElementById('back-company-text');
    if (!backContent) return;
    if (s.logoSrc) {
      back.innerHTML = `<img class="card-back-logo" src="${s.logoSrc}" style="max-height:${s.logoSize*1.5}px;max-width:60%;object-fit:contain;opacity:0.85;" />`;
    } else {
      back.innerHTML = `<span id="back-company-text" style="font-size:clamp(1rem,3vw,1.5rem);font-weight:700;opacity:0.35;color:${s.textColor};font-family:'${s.font}',sans-serif;">${s.company || 'C√©g neve'}</span>`;
    }
    back.style.background = front.style.background;
  }

  // DOWNLOAD
  async function downloadCard() {
    const wasFlipped = state.flipped;
    if (state.flipped) flipCard();

    await new Promise(r => setTimeout(r, 400));
    const el = document.getElementById('card-face-front');

    html2canvas(el, {
      scale: 3,
      useCORS: true,
      backgroundColor: null,
      logging: false
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'nevjegykartya.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
      if (wasFlipped) flipCard();
    });
  }
</script>
</body>
</html>
